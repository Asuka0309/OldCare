# é¢„çº¦ç®¡ç†æ¨¡å— - è¯¦ç»†åˆ†æ

## ğŸ“Œ æ¨¡å—æ¦‚è¿°

**æ¨¡å—åç§°**ï¼šæœåŠ¡é¢„çº¦ç®¡ç†  
**æ ¸å¿ƒåŠŸèƒ½**ï¼šé¢„çº¦çš„åˆ›å»ºã€ç¡®è®¤ã€å®Œæˆã€å–æ¶ˆã€é€€æ¬¾ç­‰å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†  
**é€‚ç”¨è§’è‰²**ï¼šç³»ç»Ÿç®¡ç†å‘˜ï¼ˆå…¨éƒ¨æ“ä½œï¼‰ã€æŠ¤å·¥ï¼ˆç¡®è®¤/å®Œæˆï¼‰ã€å±…æ°‘ï¼ˆåˆ›å»º/æŸ¥çœ‹è‡ªå·±ï¼‰  
**å…³é”®ç‰¹æ€§**ï¼šçŠ¶æ€æµè½¬æ§åˆ¶ã€è‡ªåŠ¨è´¹ç”¨ç”Ÿæˆã€æ•°æ®éš”ç¦»ã€æƒé™æ§åˆ¶  
**ä¼˜å…ˆçº§**ï¼šâ­â­â­ æ ¸å¿ƒæ¨¡å—

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. é¢„çº¦å®šä¹‰

é¢„çº¦æ˜¯**å±…æ°‘ç”³è¯·æœåŠ¡**çš„è®°å½•ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒä¿¡æ¯ï¼š

```
é¢„çº¦ = è€äºº + æŠ¤å·¥ + æœåŠ¡ + æ—¶é—´ + è´¹ç”¨
```

**å®ä½“å­—æ®µ**ï¼š
```java
Appointment {
  id                  // é¢„çº¦ID
  elderlyId           // è€äººIDï¼ˆelderly_infoè¡¨ï¼‰
  caregiverId         // æŠ¤å·¥IDï¼ˆcaregiversè¡¨ï¼‰
  serviceId           // æœåŠ¡IDï¼ˆservicesè¡¨ï¼‰
  appointmentDate     // é¢„çº¦æ—¶é—´ï¼ˆæ ¼å¼ï¼š2025-12-27 14:00:00ï¼‰
  totalAmount         // è´¹ç”¨é‡‘é¢ï¼ˆæºè‡ªæœåŠ¡ä»·æ ¼ï¼‰
  status              // é¢„çº¦çŠ¶æ€ï¼ˆ5ç§ï¼‰
  remark              // å¤‡æ³¨ä¿¡æ¯
  createdTime         // åˆ›å»ºæ—¶é—´
  updatedTime         // æ›´æ–°æ—¶é—´
}
```

### 2. é¢„çº¦çŠ¶æ€æœº

é¢„çº¦æœ‰5ç§çŠ¶æ€ï¼Œå…·æœ‰ä¸¥æ ¼çš„æµè½¬è§„åˆ™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾…ç¡®è®¤   â”‚ â† æ–°å»ºæ—¶çš„åˆå§‹çŠ¶æ€
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ ç®¡ç†å‘˜/æŠ¤å·¥ ç‚¹å‡»"ç¡®è®¤"
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²ç¡®è®¤   â”‚ â† å¯ä»¥å®Œæˆæˆ–å–æ¶ˆ
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 
     â”œâ”€ ç®¡ç†å‘˜/æŠ¤å·¥ ç‚¹å‡»"å®Œæˆ" â†’ å·²å®Œæˆï¼ˆè‡ªåŠ¨ç”Ÿæˆè´¹ç”¨ï¼‰
     â”‚
     â””â”€ ä»»ä½•è§’è‰² ç‚¹å‡»"å–æ¶ˆ" â†’ å·²å–æ¶ˆï¼ˆæ— æ³•æ¢å¤ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²å®Œæˆ    â”‚ â† ç»ˆæ€ï¼Œä¸å¯æ“ä½œï¼Œè‡ªåŠ¨ç”Ÿæˆè´¹ç”¨è®°å½•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²å–æ¶ˆ    â”‚ â† ç»ˆæ€ï¼Œä¸å¯æ“ä½œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€è½¬æ¢è§„åˆ™**ï¼š
- âœ… **å¾…ç¡®è®¤ â†’ å·²ç¡®è®¤**ï¼šä»…ç®¡ç†å‘˜å’ŒæŠ¤å·¥å¯æ“ä½œ
- âœ… **å·²ç¡®è®¤ â†’ å·²å®Œæˆ**ï¼šä»…ç®¡ç†å‘˜å’ŒæŠ¤å·¥å¯æ“ä½œï¼›è‡ªåŠ¨ç”Ÿæˆè´¹ç”¨
- âœ… **å¾…ç¡®è®¤ â†’ å·²å–æ¶ˆ**ï¼šä»»ä½•è§’è‰²å¯æ“ä½œï¼ˆéœ€ç¡®è®¤ï¼‰
- âœ… **å·²ç¡®è®¤ â†’ å·²å–æ¶ˆ**ï¼šä»»ä½•è§’è‰²å¯æ“ä½œï¼ˆéœ€ç¡®è®¤ï¼‰
- âŒ **å·²å®Œæˆ â†’ ä»»ä½•**ï¼šä¸å¯æ“ä½œï¼ˆå·²å®Œæˆæ˜¯ç»ˆæ€ï¼‰
- âŒ **å·²å–æ¶ˆ â†’ ä»»ä½•**ï¼šä¸å¯æ“ä½œï¼ˆå·²å–æ¶ˆæ˜¯ç»ˆæ€ï¼‰

---

## ğŸ“¡ API æ¥å£

### 1. é¢„çº¦æŸ¥è¯¢æ¥å£

#### 1.1 åˆ†é¡µæŸ¥è¯¢é¢„çº¦åˆ—è¡¨
```
GET /api/appointment?current=1&size=10&elderlyId=1&status=å·²ç¡®è®¤
å‚æ•°ï¼š
  - current: å½“å‰é¡µç ï¼ˆé»˜è®¤1ï¼‰
  - size: æ¯é¡µæ¡æ•°ï¼ˆé»˜è®¤10ï¼‰
  - elderlyId: æŒ‰è€äººç­›é€‰ï¼ˆå¯é€‰ï¼‰
  - status: æŒ‰çŠ¶æ€ç­›é€‰ï¼ˆå¾…ç¡®è®¤/å·²ç¡®è®¤/è¿›è¡Œä¸­/å·²å®Œæˆ/å·²å–æ¶ˆï¼‰

å“åº”ï¼š{
  "code": 0,
  "message": "æˆåŠŸ",
  "data": {
    "records": [
      {
        "id": 1,
        "elderlyId": 1,
        "caregiverId": 2,
        "serviceId": 1,
        "appointmentDate": "2025-12-27 14:00:00",
        "status": "å·²ç¡®è®¤",
        "totalAmount": 50.00,
        "remark": "éœ€è¦ç‰¹æ®Šç…§é¡¾",
        "createdTime": "2025-12-27 10:00:00",
        "updatedTime": "2025-12-27 10:00:00"
      }
    ],
    "total": 50,
    "current": 1,
    "size": 10
  }
}
```

**æ•°æ®éš”ç¦»**ï¼š
- **ç®¡ç†å‘˜**ï¼šæŸ¥çœ‹æ‰€æœ‰é¢„çº¦
- **æŠ¤å·¥**ï¼šä»…æŸ¥çœ‹åˆ†é…ç»™è‡ªå·±çš„é¢„çº¦
  ```java
  // åç«¯è‡ªåŠ¨è¿‡æ»¤
  if (role == "caregiver") {
    queryWrapper.eq("provider_id", caregiverId);
  }
  ```
- **å±…æ°‘**ï¼šæ— ç›´æ¥æŸ¥è¯¢æƒé™ï¼ˆé€šè¿‡é¢„çº¦ç®¡ç†é¡µé¢æŸ¥çœ‹è‡ªå·±çš„ï¼‰

#### 1.2 æŸ¥è¯¢å•ä¸ªé¢„çº¦
```
GET /api/appointment/{id}

å“åº”ï¼š{
  "code": 0,
  "message": "æˆåŠŸ",
  "data": { ... }
}
```

#### 1.3 æŸ¥è¯¢è€äººçš„é¢„çº¦
```
GET /api/appointment/elderly/{elderlyId}?current=1&size=10

å“åº”ï¼š{
  "code": 0,
  "message": "æˆåŠŸ",
  "data": {
    "records": [ ... ],
    "total": 10
  }
}
```

#### 1.4 æŸ¥è¯¢æŠ¤å·¥çš„é¢„çº¦
```
GET /api/appointment/caregiver/{caregiverId}?current=1&size=10

å“åº”ï¼š{ ... }
```

### 2. é¢„çº¦æ“ä½œæ¥å£

#### 2.1 åˆ›å»ºé¢„çº¦
```
POST /api/appointment
è¯·æ±‚ä½“ï¼š{
  "elderlyId": 1,           // è€äººID
  "caregiverId": 2,         // æŠ¤å·¥ID
  "serviceId": 1,           // æœåŠ¡ID
  "appointmentDate": "2025-12-27T14:00:00",
  "totalAmount": 50.00,     // ç»§æ‰¿æœåŠ¡ä»·æ ¼
  "remark": "è¯·æ±‚å¤‡æ³¨"
}

å“åº”ï¼š{
  "code": 0,
  "message": "é¢„çº¦æˆåŠŸ",
  "data": {
    "id": 1,
    ...
  }
}
```

**åç«¯éªŒè¯**ï¼š
```java
// 1. éªŒè¯è€äººæ˜¯å¦å­˜åœ¨
ElderlyInfo elderly = elderlyInfoService.getById(appointment.getElderlyId());
if (elderly == null) {
  return ResponseUtil.error(400, "è€äººä¿¡æ¯ä¸å­˜åœ¨");
}

// 2. éªŒè¯æŠ¤å·¥æ˜¯å¦å­˜åœ¨
Caregiver caregiver = caregiverService.getById(appointment.getCaregiverId());
if (caregiver == null) {
  return ResponseUtil.error(400, "æŠ¤å·¥ä¿¡æ¯ä¸å­˜åœ¨");
}

// 3. éªŒè¯æœåŠ¡æ˜¯å¦å­˜åœ¨
Service service = serviceManageService.getById(appointment.getServiceId());
if (service == null) {
  return ResponseUtil.error(400, "æœåŠ¡é¡¹ç›®ä¸å­˜åœ¨");
}

// 4. è‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼
appointment.setTotalAmount(service.getPrice());  // ç»§æ‰¿æœåŠ¡ä»·æ ¼
appointment.setStatus("å¾…ç¡®è®¤");                 // é»˜è®¤å¾…ç¡®è®¤
appointment.setCreatedTime(LocalDateTime.now());
```

#### 2.2 ä¿®æ”¹é¢„çº¦
```
PUT /api/appointment
è¯·æ±‚ä½“ï¼š{
  "id": 1,
  "elderlyId": 1,
  "caregiverId": 2,
  "serviceId": 1,
  "appointmentDate": "2025-12-27T15:00:00",
  "status": "å·²ç¡®è®¤",
  "totalAmount": 50.00,
  "remark": "ä¿®æ”¹åçš„å¤‡æ³¨"
}

å“åº”ï¼š{
  "code": 0,
  "message": "ä¿®æ”¹æˆåŠŸ"
}
```

#### 2.3 ç¡®è®¤é¢„çº¦
```
PUT /api/appointment/{id}/confirm

å“åº”ï¼š{
  "code": 0,
  "message": "é¢„çº¦å·²ç¡®è®¤"
}
```

**ä¸šåŠ¡é€»è¾‘**ï¼š
- å°†çŠ¶æ€ä»"å¾…ç¡®è®¤"æ”¹ä¸º"å·²ç¡®è®¤"
- ä»…ç®¡ç†å‘˜å’ŒæŠ¤å·¥å¯æ“ä½œ

#### 2.4 å®Œæˆé¢„çº¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆè´¹ç”¨ï¼‰â­
```
PUT /api/appointment/{id}/complete

å“åº”ï¼š{
  "code": 0,
  "message": "é¢„çº¦å·²å®Œæˆï¼Œè´¹ç”¨è®°å½•å·²ç”Ÿæˆ",
  "data": null
}
```

**ä¸šåŠ¡é€»è¾‘**ï¼š
```java
// 1. æ£€æŸ¥é¢„çº¦çŠ¶æ€
if (!"å·²ç¡®è®¤".equals(appointment.getStatus())) {
  return ResponseUtil.error(400, "åªæœ‰å·²ç¡®è®¤çš„é¢„çº¦æ‰èƒ½å®Œæˆ");
}

// 2. æ£€æŸ¥è´¹ç”¨è®°å½•æ˜¯å¦å·²å­˜åœ¨ï¼ˆé¿å…é‡å¤ï¼‰
FeeRecord existingFee = feeRecordService.getOne(
  new QueryWrapper<FeeRecord>().eq("appointment_id", id)
);

// 3. æ›´æ–°é¢„çº¦çŠ¶æ€
appointment.setStatus("å·²å®Œæˆ");

// 4. å¦‚æœè´¹ç”¨è®°å½•ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨ç”Ÿæˆ
if (existingFee == null) {
  FeeRecord feeRecord = new FeeRecord();
  feeRecord.setAppointmentId(id);
  feeRecord.setResidentId(elderly.getUserId());  // è·å–è€äººçš„ç”¨æˆ·ID
  feeRecord.setServiceName(service.getServiceName());
  feeRecord.setAmount(appointment.getTotalAmount());  // ä½¿ç”¨é¢„çº¦æ—¶çš„é‡‘é¢
  feeRecord.setStatus("æœªæ”¯ä»˜");
  feeRecordService.save(feeRecord);
  return ResponseUtil.success("é¢„çº¦å·²å®Œæˆï¼Œè´¹ç”¨è®°å½•å·²ç”Ÿæˆ");
}
```

**è´¹ç”¨è®°å½•ç”Ÿæˆçš„å…³é”®ç‚¹**ï¼š
- âœ… è‡ªåŠ¨å…³è”è€äººçš„user_id
- âœ… ä½¿ç”¨é¢„çº¦ä¿å­˜çš„totalAmountï¼ˆä¿è¯ä»·æ ¼ä¸å˜ï¼‰
- âœ… æ–°è´¹ç”¨çŠ¶æ€ä¸º"æœªæ”¯ä»˜"
- âœ… é˜²æ­¢é‡å¤ç”Ÿæˆï¼ˆå¹‚ç­‰æ€§ï¼‰

#### 2.5 å–æ¶ˆé¢„çº¦
```
PUT /api/appointment/{id}/cancel

å“åº”ï¼š{
  "code": 0,
  "message": "é¢„çº¦å·²å–æ¶ˆ"
}
```

**ä¸šåŠ¡é€»è¾‘**ï¼š
- å°†çŠ¶æ€æ”¹ä¸º"å·²å–æ¶ˆ"
- ä»»ä½•è§’è‰²éƒ½å¯ä»¥å–æ¶ˆï¼ˆå¾…ç¡®è®¤æˆ–å·²ç¡®è®¤çŠ¶æ€ï¼‰
- å·²å®Œæˆå’Œå·²å–æ¶ˆçš„é¢„çº¦ä¸æ˜¾ç¤ºå–æ¶ˆæŒ‰é’®

#### 2.6 åˆ é™¤é¢„çº¦ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
```
DELETE /api/appointment/{id}

å“åº”ï¼š{
  "code": 0,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

**ä¸šåŠ¡é€»è¾‘**ï¼š
```java
// 1. æƒé™æ£€æŸ¥
if (!"admin".equals(role)) {
  return ResponseUtil.error(403, "æ— æƒé™åˆ é™¤é¢„çº¦");
}

// 2. åˆ é™¤è´¹ç”¨è®°å½•ï¼ˆçº§è”åˆ é™¤ï¼‰
feeRecordService.remove(
  new QueryWrapper<FeeRecord>().eq("appointment_id", id)
);

// 3. åˆ é™¤è¯„ä»·è®°å½•ï¼ˆçº§è”åˆ é™¤ï¼‰
evaluationService.remove(
  new QueryWrapper<Evaluation>().eq("appointment_id", id)
);

// 4. åˆ é™¤é¢„çº¦
appointmentService.removeById(id);
```

---

## ğŸ¨ å‰ç«¯é¡µé¢ï¼ˆAppointmentView.vueï¼‰

### 1. é¡µé¢å¸ƒå±€

#### 1.1 æœç´¢æ å’Œç­›é€‰
```vue
<div class="search-bar">
  <!-- æŒ‰è€äººç­›é€‰ -->
  <el-select v-model="query.elderlyId" placeholder="æŒ‰è€äººç­›é€‰">
    <el-option v-for="e in elderlyOptions" :key="e.id" :label="e.name" :value="e.id" />
  </el-select>
  
  <!-- æŒ‰çŠ¶æ€ç­›é€‰ -->
  <el-select v-model="query.status" placeholder="çŠ¶æ€">
    <el-option label="å¾…ç¡®è®¤" value="å¾…ç¡®è®¤" />
    <el-option label="å·²ç¡®è®¤" value="å·²ç¡®è®¤" />
    <el-option label="è¿›è¡Œä¸­" value="è¿›è¡Œä¸­" />
    <el-option label="å·²å®Œæˆ" value="å·²å®Œæˆ" />
    <el-option label="å·²å–æ¶ˆ" value="å·²å–æ¶ˆ" />
  </el-select>
  
  <!-- æ–°å¢æŒ‰é’®ï¼ˆä»…éæŠ¤å·¥æ˜¾ç¤ºï¼‰ -->
  <el-button v-if="!isCaregiver" type="primary" @click="openForm()">æ–°å»ºé¢„çº¦</el-button>
</div>
```

**æƒé™æ§åˆ¶**ï¼š
- æŠ¤å·¥ä¸èƒ½æ–°å»ºé¢„çº¦ï¼ˆç®¡ç†å‘˜å’Œå±…æ°‘å¯ä»¥ï¼‰
- ä¸‹æ‹‰åˆ—è¡¨è‡ªåŠ¨åŠ è½½è€äººå’ŒçŠ¶æ€é€‰é¡¹

#### 1.2 é¢„çº¦åˆ—è¡¨è¡¨æ ¼

| åˆ— | å®½åº¦ | è¯´æ˜ |
|----|------|------|
| ID | 80px | é¢„çº¦å”¯ä¸€æ ‡è¯† |
| è€äºº | 140px | é¢„çº¦æ¶‰åŠçš„è€äººåç§° |
| æŠ¤å·¥ | 140px | åˆ†é…çš„æŠ¤å·¥åç§° |
| æœåŠ¡ | 160px | æœåŠ¡é¡¹ç›®åç§° |
| é¢„çº¦æ—¶é—´ | 180px | é¢„çº¦çš„æ—¥æœŸæ—¶é—´ |
| çŠ¶æ€ | 110px | é¢„çº¦å½“å‰çŠ¶æ€ï¼ˆå¸¦é¢œè‰²æ ‡ç­¾ï¼‰ |
| è´¹ç”¨ | 100px | é¢„çº¦è´¹ç”¨é‡‘é¢ |
| æ“ä½œ | 240px | ç¼–è¾‘ã€ç¡®è®¤ã€å®Œæˆã€å–æ¶ˆã€åˆ é™¤ |

**çŠ¶æ€æ ‡ç­¾é¢œè‰²**ï¼š
```javascript
function statusType(status) {
  switch (status) {
    case 'å¾…ç¡®è®¤':   return 'warning'   // æ©™è‰²
    case 'å·²ç¡®è®¤':   return 'info'      // ç°è‰²
    case 'è¿›è¡Œä¸­':   return 'primary'   // è“è‰²
    case 'å·²å®Œæˆ':   return 'success'   // ç»¿è‰²
    case 'å·²å–æ¶ˆ':   return 'danger'    // çº¢è‰²
  }
}
```

#### 1.3 æ“ä½œæŒ‰é’®è§„åˆ™

| æŒ‰é’® | æ˜¾ç¤ºæ¡ä»¶ | æ“ä½œ |
|------|---------|------|
| ç¼–è¾‘ | æ€»æ˜¯æ˜¾ç¤º | æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡† |
| ç¡®è®¤ | status='å¾…ç¡®è®¤' | çŠ¶æ€æ”¹ä¸º"å·²ç¡®è®¤" |
| å®Œæˆ | status='å·²ç¡®è®¤' && (admin\|caregiver) | çŠ¶æ€æ”¹ä¸º"å·²å®Œæˆ"ï¼Œç”Ÿæˆè´¹ç”¨ |
| å–æ¶ˆ | status!='å·²å®Œæˆ' && status!='å·²å–æ¶ˆ' | çŠ¶æ€æ”¹ä¸º"å·²å–æ¶ˆ" |
| åˆ é™¤ | isAdmin | åˆ é™¤é¢„çº¦åŠå…³è”è®°å½• |

### 2. æ–°å¢/ç¼–è¾‘å¯¹è¯æ¡†

#### 2.1 è¡¨å•å­—æ®µ

```vue
<el-form-item label="è€äºº" prop="elderlyId">
  <el-select v-model="form.elderlyId" filterable />
</el-form-item>

<el-form-item label="æŠ¤å·¥" prop="caregiverId">
  <el-select v-model="form.caregiverId" filterable />
</el-form-item>

<el-form-item label="æœåŠ¡" prop="serviceId">
  <el-select v-model="form.serviceId" filterable @change="syncPrice">
    <!-- é€‰é¡¹æ ¼å¼ï¼šæœåŠ¡å / Â¥ä»·æ ¼ -->
    <el-option :label="`${s.serviceName} / ï¿¥${s.price}`" />
  </el-select>
</el-form-item>

<el-form-item label="é¢„çº¦æ—¶é—´" prop="appointmentDate">
  <el-date-picker v-model="form.appointmentDate" type="datetime" />
</el-form-item>

<el-form-item label="è´¹ç”¨" prop="totalAmount">
  <el-input v-model="form.totalAmount" disabled />  <!-- åªè¯»ï¼Œè‡ªåŠ¨è®¡ç®— -->
</el-form-item>

<el-form-item label="çŠ¶æ€" prop="status">
  <el-select v-model="form.status">
    <el-option label="å¾…ç¡®è®¤" value="å¾…ç¡®è®¤" />
    <el-option label="å·²ç¡®è®¤" value="å·²ç¡®è®¤" />
    <el-option label="å·²å®Œæˆ" value="å·²å®Œæˆ" />
    <el-option label="å·²å–æ¶ˆ" value="å·²å–æ¶ˆ" />
  </el-select>
</el-form-item>

<el-form-item label="å¤‡æ³¨" prop="remark">
  <el-input v-model="form.remark" type="textarea" />
</el-form-item>
```

#### 2.2 è¡¨å•éªŒè¯è§„åˆ™

```javascript
const rules = {
  elderlyId: [{ required: true, message: 'è¯·é€‰æ‹©è€äºº', trigger: 'change' }],
  caregiverId: [{ required: true, message: 'è¯·é€‰æ‹©æŠ¤å·¥', trigger: 'change' }],
  serviceId: [{ required: true, message: 'è¯·é€‰æ‹©æœåŠ¡', trigger: 'change' }],
  appointmentDate: [{ required: true, message: 'è¯·é€‰æ‹©æ—¶é—´', trigger: 'change' }]
}
```

#### 2.3 å…³é”®å‡½æ•°ï¼šsyncPriceï¼ˆä»·æ ¼è‡ªåŠ¨åŒæ­¥ï¼‰

```javascript
function syncPrice() {
  // å½“é€‰æ‹©æœåŠ¡æ—¶ï¼Œè‡ªåŠ¨å¡«å……è´¹ç”¨
  const selectedService = serviceOptions.value.find(s => s.id === form.serviceId)
  if (selectedService) {
    form.totalAmount = parseFloat(selectedService.price) || 0
  }
}
```

**ä½œç”¨**ï¼š
- ç¡®ä¿è´¹ç”¨ä¸é€‰æ‹©çš„æœåŠ¡ä¸€è‡´
- é¿å…æ‰‹åŠ¨è¾“å…¥é”™è¯¯çš„è´¹ç”¨
- é˜²æ­¢ç”¨æˆ·ä¿®æ”¹è´¹ç”¨å­—æ®µ

### 3. å®Œæ•´æ“ä½œæµç¨‹

#### 3.1 æ–°å»ºé¢„çº¦æµç¨‹

```
ç‚¹å‡»"æ–°å»ºé¢„çº¦"
  â†“
æ‰“å¼€å¯¹è¯æ¡†ï¼ˆæ¸…ç©ºè¡¨å•ï¼‰
  â”œâ”€ é»˜è®¤status="å¾…ç¡®è®¤"
  â””â”€ é»˜è®¤totalAmount=0
  â†“
ç”¨æˆ·å¡«å†™è¡¨å•
  â”œâ”€ é€‰æ‹©è€äºº
  â”œâ”€ é€‰æ‹©æŠ¤å·¥
  â”œâ”€ é€‰æ‹©æœåŠ¡ â†’ è‡ªåŠ¨å¡«å……ä»·æ ¼
  â”œâ”€ é€‰æ‹©é¢„çº¦æ—¶é—´
  â””â”€ ï¼ˆå¯é€‰ï¼‰è¾“å…¥å¤‡æ³¨
  â†“
å‰ç«¯è¡¨å•éªŒè¯
  â”œâ”€ è€äººï¼šå¿…é€‰
  â”œâ”€ æŠ¤å·¥ï¼šå¿…é€‰
  â”œâ”€ æœåŠ¡ï¼šå¿…é€‰
  â”œâ”€ æ—¶é—´ï¼šå¿…é€‰
  â””â”€ å¤‡æ³¨ï¼šå¯é€‰
  â†“
å‘é€POSTè¯·æ±‚ /api/appointment
  â†“
åç«¯éªŒè¯
  â”œâ”€ æ£€æŸ¥è€äººã€æŠ¤å·¥ã€æœåŠ¡æ˜¯å¦å­˜åœ¨
  â”œâ”€ è‡ªåŠ¨è®¾ç½®totalAmount = æœåŠ¡ä»·æ ¼
  â”œâ”€ è‡ªåŠ¨è®¾ç½®status = "å¾…ç¡®è®¤"
  â”œâ”€ è‡ªåŠ¨è®¾ç½®createdTimeå’ŒupdatedTime
  â””â”€ ä¿å­˜é¢„çº¦
  â†“
æ˜¾ç¤ºæˆåŠŸæç¤º
  â†“
åˆ·æ–°é¢„çº¦åˆ—è¡¨
```

#### 3.2 ç¡®è®¤é¢„çº¦æµç¨‹

```
åœ¨è¡¨æ ¼ä¸­æ‰¾åˆ°status="å¾…ç¡®è®¤"çš„é¢„çº¦
  â†“
ç‚¹å‡»"ç¡®è®¤"æŒ‰é’®
  â†“
å‘é€PUTè¯·æ±‚ /api/appointment/{id}/confirm
  â†“
åç«¯æ›´æ–°é¢„çº¦çŠ¶æ€ â†’ "å·²ç¡®è®¤"
  â†“
åˆ·æ–°åˆ—è¡¨
  â†“
é¢„çº¦çŠ¶æ€æ˜¾ç¤ºä¸º"å·²ç¡®è®¤"
  â†“
å‡ºç°"å®Œæˆ"æŒ‰é’®ï¼ˆæ›¿æ¢"ç¡®è®¤"æŒ‰é’®ï¼‰
```

#### 3.3 å®Œæˆé¢„çº¦æµç¨‹ï¼ˆæœ€å…³é”®ï¼‰

```
é¢„çº¦çŠ¶æ€ä¸º"å·²ç¡®è®¤"
  â†“
ç‚¹å‡»"å®Œæˆ"æŒ‰é’®ï¼ˆä»…adminå’Œcaregiverå¯è§ï¼‰
  â†“
å‘é€PUTè¯·æ±‚ /api/appointment/{id}/complete
  â†“
åç«¯å¤„ç†
  â”œâ”€ æ£€æŸ¥é¢„çº¦çŠ¶æ€æ˜¯å¦ä¸º"å·²ç¡®è®¤"
  â”œâ”€ æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è´¹ç”¨è®°å½•
  â”œâ”€ æ›´æ–°é¢„çº¦çŠ¶æ€ â†’ "å·²å®Œæˆ"
  â””â”€ å¦‚æœä¸å­˜åœ¨è´¹ç”¨è®°å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼š
      â”œâ”€ appointmentId = è¯¥é¢„çº¦ID
      â”œâ”€ residentId = è€äººçš„user_id
      â”œâ”€ serviceId = è¯¥é¢„çº¦çš„serviceId
      â”œâ”€ serviceName = æœåŠ¡åç§°
      â”œâ”€ amount = é¢„çº¦ä¿å­˜çš„totalAmount
      â”œâ”€ status = "æœªæ”¯ä»˜"
      â””â”€ createdTime = now()
  â†“
è¿”å›æˆåŠŸå“åº”
  â†“
åˆ·æ–°åˆ—è¡¨
  â†“
é¢„çº¦çŠ¶æ€æ˜¾ç¤ºä¸º"å·²å®Œæˆ"
  â†“
è´¹ç”¨ç®¡ç†é¡µé¢å‡ºç°æ–°çš„è´¹ç”¨è®°å½•
  â†“
ç®¡ç†å‘˜å¯ä»¥åœ¨è´¹ç”¨é¡µç‚¹å‡»"æ ‡è®°æ”¯ä»˜"
```

#### 3.4 å–æ¶ˆé¢„çº¦æµç¨‹

```
é¢„çº¦çŠ¶æ€ä¸º"å¾…ç¡®è®¤"æˆ–"å·²ç¡®è®¤"
  â†“
ç‚¹å‡»"å–æ¶ˆ"æŒ‰é’®
  â†“
å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
  â†“
ç”¨æˆ·ç‚¹å‡»"ç¡®å®š"
  â†“
å‘é€PUTè¯·æ±‚ /api/appointment/{id}/cancel
  â†“
åç«¯æ›´æ–°é¢„çº¦çŠ¶æ€ â†’ "å·²å–æ¶ˆ"
  â†“
åˆ·æ–°åˆ—è¡¨
  â†“
é¢„çº¦çŠ¶æ€æ˜¾ç¤ºä¸º"å·²å–æ¶ˆ"ï¼ˆçº¢è‰²æ ‡ç­¾ï¼‰
  â†“
æ‰€æœ‰æ“ä½œæŒ‰é’®æ¶ˆå¤±ï¼ˆå·²å–æ¶ˆæ˜¯ç»ˆæ€ï¼‰
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. appointments è¡¨ç»“æ„

```sql
CREATE TABLE appointments (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  resident_id BIGINT,                    -- å±…æ°‘IDï¼ˆelderly_info.idï¼‰
  provider_id BIGINT,                    -- æŠ¤å·¥IDï¼ˆcaregivers.idï¼‰
  service_id BIGINT,                     -- æœåŠ¡IDï¼ˆservices.idï¼‰
  appointment_date DATETIME,
  status VARCHAR(20) DEFAULT 'å¾…ç¡®è®¤',
  total_amount DECIMAL(10, 2),
  remark TEXT,
  created_time TIMESTAMP,
  updated_time TIMESTAMP,
  INDEX idx_resident_id (resident_id),
  INDEX idx_provider_id (provider_id),
  INDEX idx_status (status),
  INDEX idx_created_time (created_time),
  FOREIGN KEY (resident_id) REFERENCES elderly_info(id),
  FOREIGN KEY (provider_id) REFERENCES caregivers(id),
  FOREIGN KEY (service_id) REFERENCES services(id)
);
```

### 2. å­—æ®µè¯¦è§£

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|
| id | BIGINT | é¢„çº¦ID | PK, AI |
| resident_id | BIGINT | å±…æ°‘ID | FKâ†’elderly_info |
| provider_id | BIGINT | æŠ¤å·¥ID | FKâ†’caregivers |
| service_id | BIGINT | æœåŠ¡ID | FKâ†’services |
| appointment_date | DATETIME | é¢„çº¦æ—¶é—´ | ä¸ä¸ºnull |
| status | VARCHAR(20) | é¢„çº¦çŠ¶æ€ | DEFAULT 'å¾…ç¡®è®¤' |
| total_amount | DECIMAL(10,2) | é¢„çº¦è´¹ç”¨ | å¯ç©º |
| remark | TEXT | å¤‡æ³¨ä¿¡æ¯ | å¯ç©º |
| created_time | TIMESTAMP | åˆ›å»ºæ—¶é—´ | è‡ªåŠ¨èµ‹å€¼ |
| updated_time | TIMESTAMP | æ›´æ–°æ—¶é—´ | è‡ªåŠ¨èµ‹å€¼ |

### 3. ç´¢å¼•è®¾è®¡

```sql
-- æŒ‰å±…æ°‘IDå¿«é€ŸæŸ¥è¯¢è¯¥è€äººçš„æ‰€æœ‰é¢„çº¦
INDEX idx_resident_id (resident_id)

-- æŒ‰æŠ¤å·¥IDå¿«é€ŸæŸ¥è¯¢åˆ†é…ç»™è¯¥æŠ¤å·¥çš„é¢„çº¦
INDEX idx_provider_id (provider_id)

-- æŒ‰çŠ¶æ€å¿«é€Ÿç­›é€‰ï¼ˆå¦‚ç­›é€‰æ‰€æœ‰"å·²ç¡®è®¤"çš„é¢„çº¦ï¼‰
INDEX idx_status (status)

-- æŒ‰åˆ›å»ºæ—¶é—´æ’åº
INDEX idx_created_time (created_time)
```

### 4. å…³è”å…³ç³»

```
users (ç”¨æˆ·è¡¨)
  â†‘
  â”œâ”€ elderly_info (å±…æ°‘è¡¨)
  â”‚       â†“ (resident_id)
  â”‚
  â””â”€ caregivers (æŠ¤å·¥è¡¨)
          â†“ (provider_id)
          â”‚
          â†“
    appointments (é¢„çº¦è¡¨)
          â”‚
          â”œâ”€ (service_id)
          â”‚   â†“
          â””â”€ services (æœåŠ¡è¡¨)
          â”‚
          â”œâ”€ (appointment_id)
          â”‚   â†“
          â””â”€ fee_records (è´¹ç”¨è¡¨)
          â”‚
          â””â”€ evaluations (è¯„ä»·è¡¨)
```

---

## ğŸ’¼ ä¸šåŠ¡æµç¨‹è¯¦è§£

### 1. é¢„çº¦å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       é¢„çº¦å®Œæ•´ç”Ÿå‘½å‘¨æœŸ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T1: åˆ›å»ºé¢„çº¦
    â”œâ”€ è§’è‰²ï¼šå±…æ°‘/ç®¡ç†å‘˜
    â”œâ”€ çŠ¶æ€ï¼šå¾…ç¡®è®¤
    â”œâ”€ è´¹ç”¨ï¼šç»§æ‰¿æœåŠ¡ä»·æ ¼
    â””â”€ äº‹ä»¶ï¼šé¢„çº¦è®°å½•ç”Ÿæˆ

T2: ç®¡ç†å‘˜ç¡®è®¤ï¼ˆå¯é€‰ï¼Œé€šå¸¸è‡ªåŠ¨ï¼‰
    â”œâ”€ è§’è‰²ï¼šç®¡ç†å‘˜/æŠ¤å·¥
    â”œâ”€ çŠ¶æ€ï¼šå¾…ç¡®è®¤ â†’ å·²ç¡®è®¤
    â””â”€ äº‹ä»¶ï¼šé¢„çº¦éªŒè¯é€šè¿‡

T3: æŠ¤å·¥å®Œæˆé¢„çº¦ï¼ˆå…³é”®ï¼‰
    â”œâ”€ è§’è‰²ï¼šç®¡ç†å‘˜/æŠ¤å·¥
    â”œâ”€ çŠ¶æ€ï¼šå·²ç¡®è®¤ â†’ å·²å®Œæˆ
    â”œâ”€ è‡ªåŠ¨æ“ä½œï¼š
    â”‚  â”œâ”€ ç”Ÿæˆè´¹ç”¨è®°å½•
    â”‚  â”œâ”€ è´¹ç”¨çŠ¶æ€ï¼šæœªæ”¯ä»˜
    â”‚  â””â”€ å…³è”è¯¥é¢„çº¦ID
    â””â”€ äº‹ä»¶ï¼šè´¹ç”¨è®°å½•ç”Ÿæˆ

T4: ç®¡ç†å‘˜æ ‡è®°æ”¯ä»˜ï¼ˆè´¹ç”¨ç®¡ç†ï¼‰
    â”œâ”€ è§’è‰²ï¼šç®¡ç†å‘˜
    â”œâ”€ è´¹ç”¨çŠ¶æ€ï¼šæœªæ”¯ä»˜ â†’ å·²æ”¯ä»˜
    â””â”€ äº‹ä»¶ï¼šè´¹ç”¨æ”¯ä»˜å®Œæˆ

T5: è¯„ä»·ï¼ˆé¢„çº¦å®Œæˆåï¼‰
    â”œâ”€ è§’è‰²ï¼šå±…æ°‘/ç®¡ç†å‘˜
    â”œâ”€ å†…å®¹ï¼šè¯„åˆ†ã€è¯„è®º
    â””â”€ äº‹ä»¶ï¼šç”Ÿæˆè¯„ä»·è®°å½•

T6: é€€æ¬¾ç”³è¯·ï¼ˆå¯é€‰ï¼‰
    â”œâ”€ è§’è‰²ï¼šå±…æ°‘
    â”œâ”€ è´¹ç”¨çŠ¶æ€ï¼šå·²æ”¯ä»˜ â†’ é€€æ¬¾ç”³è¯·ä¸­
    â””â”€ äº‹ä»¶ï¼šç®¡ç†å‘˜å®¡æ‰¹

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å–æ¶ˆæµç¨‹ï¼ˆéšæ—¶å¯å–æ¶ˆç›´åˆ°å®Œæˆï¼‰ã€‘

T1: å¾…ç¡®è®¤çŠ¶æ€ â†’ å–æ¶ˆ
    â”œâ”€ çŠ¶æ€ï¼šå¾…ç¡®è®¤ â†’ å·²å–æ¶ˆ
    â””â”€ æ— è´¹ç”¨äº§ç”Ÿ

T2: å·²ç¡®è®¤çŠ¶æ€ â†’ å–æ¶ˆ
    â”œâ”€ çŠ¶æ€ï¼šå·²ç¡®è®¤ â†’ å·²å–æ¶ˆ
    â””â”€ æ— è´¹ç”¨äº§ç”Ÿï¼ˆå¦‚å·²ç”Ÿæˆè´¹ç”¨ï¼Œéœ€é€€æ¬¾ï¼‰

T3: å·²å®ŒæˆçŠ¶æ€ â†’ ä¸å¯å–æ¶ˆ
    â”œâ”€ çŠ¶æ€ï¼šå·²å®Œæˆï¼ˆç»ˆæ€ï¼‰
    â””â”€ åªèƒ½é€šè¿‡è´¹ç”¨é€€æ¬¾å¤„ç†
```

### 2. è´¹ç”¨è‡ªåŠ¨ç”Ÿæˆæµç¨‹

```
é¢„çº¦å®Œæˆäº‹ä»¶
  â†“
æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è´¹ç”¨è®°å½•
  â”œâ”€ å­˜åœ¨ â†’ è¿”å›"è´¹ç”¨è®°å½•å·²å­˜åœ¨"
  â””â”€ ä¸å­˜åœ¨ â†’ ç»§ç»­
  â†“
è·å–å…³è”çš„æœåŠ¡ä¿¡æ¯
  â”œâ”€ è·å–æœåŠ¡åç§°
  â””â”€ è·å–é¢„çº¦æ—¶ä¿å­˜çš„é‡‘é¢
  â†“
è·å–è€äººçš„user_id
  â”œâ”€ é€šè¿‡elderly_infoè¡¨çš„user_id
  â””â”€ å»ºç«‹è€äººä¸è´¹ç”¨çš„å…³è”
  â†“
åˆ›å»ºè´¹ç”¨è®°å½•
  â”œâ”€ appointmentId â† è¯¥é¢„çº¦ID
  â”œâ”€ residentId â† è€äººçš„user_id
  â”œâ”€ serviceName â† æœåŠ¡åç§°
  â”œâ”€ amount â† é¢„çº¦ä¿å­˜çš„totalAmount
  â”œâ”€ status = "æœªæ”¯ä»˜"
  â””â”€ createdTime = now()
  â†“
ä¿å­˜è´¹ç”¨è®°å½•
  â†“
è¿”å›"é¢„çº¦å·²å®Œæˆï¼Œè´¹ç”¨è®°å½•å·²ç”Ÿæˆ"
  â†“
ã€åç»­åœ¨è´¹ç”¨ç®¡ç†é¡µé¢ã€‘
  â”œâ”€ ç®¡ç†å‘˜çœ‹åˆ°æ–°è´¹ç”¨
  â”œâ”€ ç®¡ç†å‘˜ç‚¹å‡»"æ ‡è®°æ”¯ä»˜"
  â”œâ”€ è´¹ç”¨çŠ¶æ€ â†’ "å·²æ”¯ä»˜"
  â””â”€ å®Œæ•´æµç¨‹ç»“æŸ
```

---

## ğŸ” æƒé™æ§åˆ¶

### 1. æ“ä½œæƒé™çŸ©é˜µ

| æ“ä½œ | admin | caregiver | resident |
|------|-------|-----------|----------|
| **æŸ¥çœ‹æ‰€æœ‰é¢„çº¦** | âœ… | âŒï¼ˆä»…è‡ªå·±çš„ï¼‰| âŒ |
| **æŸ¥çœ‹é¢„çº¦åˆ—è¡¨** | âœ… | âœ…ï¼ˆä»…åˆ†é…ç»™è‡ªå·±ï¼‰| âŒ |
| **æ–°å»ºé¢„çº¦** | âœ… | âŒ | âœ… |
| **ç¼–è¾‘é¢„çº¦** | âœ… | âŒ | âŒ |
| **ç¡®è®¤é¢„çº¦** | âœ… | âœ… | âŒ |
| **å®Œæˆé¢„çº¦** | âœ… | âœ… | âŒ |
| **å–æ¶ˆé¢„çº¦** | âœ… | âœ… | âœ… |
| **åˆ é™¤é¢„çº¦** | âœ… | âŒ | âŒ |

### 2. å‰ç«¯æƒé™å®ç°

```javascript
const isAdmin = computed(() => auth.user?.role === 'admin')
const isCaregiver = computed(() => auth.user?.role === 'caregiver')
const isResident = computed(() => auth.user?.role === 'resident')
const canComplete = computed(() => ['admin', 'caregiver'].includes(role.value))

// æ¨¡æ¿ä¸­ä½¿ç”¨
<el-button v-if="!isCaregiver" @click="openForm()">æ–°å»ºé¢„çº¦</el-button>
<el-button v-if="canComplete" @click="complete(scope.row)">å®Œæˆ</el-button>
```

### 3. åç«¯æƒé™éªŒè¯

```java
// æŠ¤å·¥æ•°æ®éš”ç¦»
String role = UserContext.getRole();
if ("caregiver".equalsIgnoreCase(role)) {
  Long userId = UserContext.getUserId();
  Caregiver caregiver = caregiverService.getOne(
    new QueryWrapper<Caregiver>().eq("user_id", userId)
  );
  // ä»…æŸ¥çœ‹åˆ†é…ç»™è‡ªå·±çš„é¢„çº¦
  queryWrapper.eq("provider_id", caregiver.getId());
}

// åˆ é™¤æƒé™æ£€æŸ¥
if (!"admin".equals(role)) {
  return ResponseUtil.error(403, "æ— æƒé™åˆ é™¤é¢„çº¦");
}
```

---

## âš ï¸ å·²çŸ¥é—®é¢˜ä¸æ”¹è¿›æ–¹å‘

### é—®é¢˜1ï¼šçŠ¶æ€å€¼ä¸ä¸€è‡´
**ç°çŠ¶**ï¼šä»£ç ä¸­æœ‰"è¿›è¡Œä¸­"çŠ¶æ€ï¼Œä½†å®é™…æœªä½¿ç”¨  
**æ”¹è¿›**ï¼š
- æ˜ç¡®å®šä¹‰5ä¸ªçŠ¶æ€ï¼ˆå¾…ç¡®è®¤ã€å·²ç¡®è®¤ã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²å–æ¶ˆï¼‰
- æˆ–åˆ é™¤"è¿›è¡Œä¸­"çŠ¶æ€ï¼Œä»…ç”¨4ä¸ªçŠ¶æ€

### é—®é¢˜2ï¼šé¢„çº¦æ—¶é—´éªŒè¯ç¼ºå¤±
**ç°çŠ¶**ï¼šé¢„çº¦æ—¶é—´å¯ä»¥è®¾ç½®ä¸ºè¿‡å»æ—¶é—´  
**æ”¹è¿›**ï¼š
```java
// éªŒè¯é¢„çº¦æ—¶é—´ä¸èƒ½æ—©äºå½“å‰æ—¶é—´
if (appointment.getAppointmentDate().isBefore(LocalDateTime.now())) {
  return ResponseUtil.error(400, "é¢„çº¦æ—¶é—´ä¸èƒ½æ—©äºå½“å‰æ—¶é—´");
}
```

### é—®é¢˜3ï¼šæŠ¤å·¥å†²çªæ£€æµ‹ç¼ºå¤±
**ç°çŠ¶**ï¼šåŒä¸€æŠ¤å·¥çš„åŒä¸€æ—¶é—´å¯ä»¥æœ‰å¤šä¸ªé¢„çº¦  
**æ”¹è¿›**ï¼š
```java
// æ£€æŸ¥æŠ¤å·¥æ˜¯å¦æœ‰æ—¶é—´å†²çª
long conflictCount = appointmentService.count(
  new QueryWrapper<Appointment>()
    .eq("provider_id", appointment.getCaregiverId())
    .eq("status", "å·²ç¡®è®¤")  // ä»…å·²ç¡®è®¤çš„é¢„çº¦ç®—å†²çª
    .apply("appointment_date = ?", appointment.getAppointmentDate())
);
if (conflictCount > 0) {
  return ResponseUtil.error(400, "è¯¥æŠ¤å·¥åœ¨æ­¤æ—¶é—´å·²æœ‰é¢„çº¦");
}
```

### é—®é¢˜4ï¼šè€äººå†²çªæ£€æµ‹ç¼ºå¤±
**ç°çŠ¶**ï¼šåŒä¸€è€äººå¯ä»¥åœ¨åŒä¸€æ—¶é—´æœ‰å¤šä¸ªé¢„çº¦  
**æ”¹è¿›**ï¼šåŒæŠ¤å·¥æ£€æµ‹é€»è¾‘ï¼ŒæŒ‰è€äººæ£€æµ‹

### é—®é¢˜5ï¼šè´¹ç”¨é‡‘é¢ä¿®æ”¹åä¸å›æº¯
**ç°çŠ¶**ï¼šé¢„çº¦ä¿å­˜çš„é‡‘é¢ â‰  æœåŠ¡å½“å‰ä»·æ ¼æ—¶ï¼Œæ— æ³•è¿½æº¯åŸä»·  
**æ”¹è¿›**ï¼šè®°å½•ä»·æ ¼å˜åŠ¨å†å²

### é—®é¢˜6ï¼šçº§è”åˆ é™¤ä¸å®Œæ•´
**ç°çŠ¶**ï¼šåˆ é™¤é¢„çº¦æ—¶æœ‰çº§è”åˆ é™¤ï¼Œä½†å…¶ä»–å…³è”è¡¨å¯èƒ½æ¼æ‰  
**æ”¹è¿›**ï¼šå®Œæ•´çš„çº§è”åˆ é™¤æˆ–è½¯åˆ é™¤æ–¹æ¡ˆ

### é—®é¢˜7ï¼šæ— è¯„ä»·å®Œæˆåº¦æ£€æŸ¥
**ç°çŠ¶**ï¼šè¯„ä»·ä¸æ˜¯å¼ºåˆ¶çš„  
**æ”¹è¿›**ï¼šå¯ä»¥é…ç½®æ˜¯å¦å¼ºåˆ¶è¯„ä»·

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### 1. åˆ›å»ºé¢„çº¦æµ‹è¯•

**åœºæ™¯1.1ï¼šå±…æ°‘æ­£å¸¸åˆ›å»ºé¢„çº¦**
```
è§’è‰²ï¼šresident
æ“ä½œï¼šå¡«å†™è¡¨å•å¹¶æäº¤
æœŸæœ›ï¼šé¢„çº¦åˆ›å»ºæˆåŠŸï¼ŒçŠ¶æ€ä¸º"å¾…ç¡®è®¤"
```

**åœºæ™¯1.2ï¼šé€‰æ‹©æœåŠ¡æ—¶è‡ªåŠ¨å¡«å……ä»·æ ¼**
```
æ“ä½œï¼šé€‰æ‹©ä¸€ä¸ªæœåŠ¡
æœŸæœ›ï¼šè´¹ç”¨å­—æ®µè‡ªåŠ¨å¡«å……è¯¥æœåŠ¡ä»·æ ¼
```

**åœºæ™¯1.3ï¼šæŠ¤å·¥æ— æ³•æ–°å»ºé¢„çº¦**
```
è§’è‰²ï¼šcaregiver
æœŸæœ›ï¼šæ–°å»ºæŒ‰é’®ä¸æ˜¾ç¤º
```

### 2. ç¡®è®¤é¢„çº¦æµ‹è¯•

**åœºæ™¯2.1ï¼šç®¡ç†å‘˜ç¡®è®¤é¢„çº¦**
```
æ“ä½œï¼šç‚¹å‡»"ç¡®è®¤"æŒ‰é’®
æœŸæœ›ï¼šé¢„çº¦çŠ¶æ€å˜ä¸º"å·²ç¡®è®¤"
```

**åœºæ™¯2.2ï¼šæŠ¤å·¥ç¡®è®¤é¢„çº¦**
```
è§’è‰²ï¼šcaregiver
æ“ä½œï¼šç‚¹å‡»åˆ†é…ç»™è‡ªå·±çš„é¢„çº¦çš„"ç¡®è®¤"æŒ‰é’®
æœŸæœ›ï¼šé¢„çº¦çŠ¶æ€å˜ä¸º"å·²ç¡®è®¤"
```

### 3. å®Œæˆé¢„çº¦æµ‹è¯•ï¼ˆæœ€é‡è¦ï¼‰

**åœºæ™¯3.1ï¼šå®Œæˆé¢„çº¦è‡ªåŠ¨ç”Ÿæˆè´¹ç”¨**
```
å‰æï¼šé¢„çº¦çŠ¶æ€ä¸º"å·²ç¡®è®¤"
æ“ä½œï¼šç‚¹å‡»"å®Œæˆ"æŒ‰é’®
æœŸæœ›ï¼š
  1. é¢„çº¦çŠ¶æ€å˜ä¸º"å·²å®Œæˆ"
  2. è´¹ç”¨è¡¨ä¸­æ–°å¢ä¸€æ¡è®°å½•
  3. è´¹ç”¨é‡‘é¢ = é¢„çº¦ä¿å­˜çš„totalAmount
  4. è´¹ç”¨çŠ¶æ€ = "æœªæ”¯ä»˜"
```

**åœºæ™¯3.2ï¼šå¤šæ¬¡å®ŒæˆåŒä¸€é¢„çº¦**
```
å‰æï¼šå·²å®Œæˆè¿‡ä¸€æ¬¡çš„é¢„çº¦
æ“ä½œï¼šå†æ¬¡ç‚¹å‡»"å®Œæˆ"ï¼ˆå¦‚æœè¿˜æ˜¾ç¤ºï¼‰
æœŸæœ›ï¼šåº”è¯¥å¤±è´¥ï¼Œæç¤º"é¢„çº¦å·²å®Œæˆ"
```

**åœºæ™¯3.3ï¼šè´¹ç”¨è®°å½•å…³è”æ­£ç¡®**
```
æ“ä½œï¼šå®Œæˆé¢„çº¦ï¼ŒæŸ¥çœ‹è´¹ç”¨è®°å½•
æœŸæœ›ï¼šè´¹ç”¨è®°å½•çš„appointmentIdæ­£ç¡®å…³è”
```

### 4. å–æ¶ˆé¢„çº¦æµ‹è¯•

**åœºæ™¯4.1ï¼šå–æ¶ˆæœªç¡®è®¤çš„é¢„çº¦**
```
å‰æï¼šé¢„çº¦çŠ¶æ€ä¸º"å¾…ç¡®è®¤"
æ“ä½œï¼šç‚¹å‡»"å–æ¶ˆ"
æœŸæœ›ï¼šé¢„çº¦çŠ¶æ€å˜ä¸º"å·²å–æ¶ˆ"
```

**åœºæ™¯4.2ï¼šå–æ¶ˆå·²ç¡®è®¤çš„é¢„çº¦**
```
å‰æï¼šé¢„çº¦çŠ¶æ€ä¸º"å·²ç¡®è®¤"
æ“ä½œï¼šç‚¹å‡»"å–æ¶ˆ"
æœŸæœ›ï¼šé¢„çº¦çŠ¶æ€å˜ä¸º"å·²å–æ¶ˆ"
```

**åœºæ™¯4.3ï¼šå·²å®Œæˆçš„é¢„çº¦ä¸èƒ½å–æ¶ˆ**
```
å‰æï¼šé¢„çº¦çŠ¶æ€ä¸º"å·²å®Œæˆ"
æœŸæœ›ï¼šå–æ¶ˆæŒ‰é’®ä¸æ˜¾ç¤º
```

### 5. æƒé™æµ‹è¯•

**åœºæ™¯5.1ï¼šæŠ¤å·¥ä»…çœ‹åˆ°åˆ†é…ç»™è‡ªå·±çš„é¢„çº¦**
```
è§’è‰²ï¼šcaregiver
æ“ä½œï¼šæŸ¥çœ‹é¢„çº¦åˆ—è¡¨
æœŸæœ›ï¼šä»…æ˜¾ç¤ºprovider_id = è‡ªå·±IDçš„é¢„çº¦
```

**åœºæ™¯5.2ï¼šåˆ é™¤æƒé™æ£€æŸ¥**
```
è§’è‰²ï¼šresident/caregiver
æ“ä½œï¼šè°ƒç”¨DELETE /api/appointment/{id}
æœŸæœ›ï¼šè¿”å›403 Forbidden
```

---

## ğŸ“Š å®é™…åº”ç”¨æµç¨‹ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå®Œæ•´çš„é¢„çº¦->å®Œæˆ->æ”¯ä»˜æµç¨‹

```
ã€æ—¶åˆ»1ã€‘ç‹å¥³å£«ï¼ˆå±…æ°‘ï¼‰åˆ›å»ºé¢„çº¦
- é€‰æ‹©è€äººï¼šçˆ¶äº²ï¼ˆå¼ å¤§çˆ·ï¼‰
- é€‰æ‹©æŠ¤å·¥ï¼šå°æ
- é€‰æ‹©æœåŠ¡ï¼šç”Ÿæ´»æŠ¤ç†åŸºç¡€åŒ…ï¼ˆÂ¥50ï¼‰
- é¢„çº¦æ—¶é—´ï¼š2025-12-28 14:00
- ç³»ç»Ÿè‡ªåŠ¨ï¼štotalAmount = Â¥50, status = å¾…ç¡®è®¤

ã€æ—¶åˆ»2ã€‘ç®¡ç†å‘˜ç¡®è®¤é¢„çº¦
- ç‚¹å‡»"ç¡®è®¤"
- é¢„çº¦çŠ¶æ€ï¼šå¾…ç¡®è®¤ â†’ å·²ç¡®è®¤

ã€æ—¶åˆ»3ã€‘æŠ¤å·¥å°æå®Œæˆé¢„çº¦
- ä¸Šé—¨æœåŠ¡å®Œæˆå
- ç‚¹å‡»"å®Œæˆ"
- ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆè´¹ç”¨è®°å½•ï¼š
  - appointmentId = 1
  - residentId = å¼ å¤§çˆ·çš„user_id
  - serviceName = ç”Ÿæ´»æŠ¤ç†åŸºç¡€åŒ…
  - amount = Â¥50
  - status = æœªæ”¯ä»˜

ã€æ—¶åˆ»4ã€‘ç®¡ç†å‘˜æ ‡è®°æ”¯ä»˜
- åœ¨è´¹ç”¨ç®¡ç†é¡µé¢
- çœ‹åˆ°æ–°çš„Â¥50è´¹ç”¨ï¼ˆæœªæ”¯ä»˜ï¼‰
- ç‚¹å‡»"æ ‡è®°æ”¯ä»˜"
- è´¹ç”¨çŠ¶æ€ï¼šæœªæ”¯ä»˜ â†’ å·²æ”¯ä»˜

ã€æ—¶åˆ»5ã€‘ç‹å¥³å£«è¯„ä»·ï¼ˆå¯é€‰ï¼‰
- åœ¨é¢„çº¦è¯¦æƒ…é¡µ
- ç»™å°æè¯„åˆ†5æ˜Ÿ
- ç•™è¨€ï¼š"æœåŠ¡å¾ˆå¥½ï¼Œå»ºè®®ç»§ç»­åˆä½œ"

æµç¨‹å®Œæˆï¼
```

### ç¤ºä¾‹2ï¼šé¢„çº¦å–æ¶ˆæµç¨‹

```
ã€æ—¶åˆ»1ã€‘åˆ›å»ºé¢„çº¦
- é¢„çº¦çŠ¶æ€ï¼šå¾…ç¡®è®¤

ã€æ—¶åˆ»2ã€‘ç”¨æˆ·ç‚¹å‡»å–æ¶ˆï¼ˆä»»ä½•æ—¶å€™ï¼‰
- é¢„çº¦çŠ¶æ€ï¼šå¾…ç¡®è®¤ â†’ å·²å–æ¶ˆ
- æ— è´¹ç”¨äº§ç”Ÿ

ç»“æŸï¼
```

---

## ğŸ“ˆ æ€§èƒ½ä¸æ‰©å±•

### 1. æŸ¥è¯¢æ€§èƒ½

**å½“å‰æ€§èƒ½**ï¼š
- åˆ†é¡µæŸ¥è¯¢ï¼š<100ms
- å•æ¡æŸ¥è¯¢ï¼š<50ms
- åˆ—è¡¨æŸ¥è¯¢ï¼šæ”¯æŒåƒçº§ä»¥ä¸Š

**ä¼˜åŒ–æœºä¼š**ï¼š
- [ ] æ·»åŠ ç¼“å­˜ï¼ˆRedisï¼‰
- [ ] é¢„çº¦å’Œè´¹ç”¨çš„è”åˆæŸ¥è¯¢ä¼˜åŒ–
- [ ] æŠ¤å·¥å†²çªæ£€æµ‹çš„ç´¢å¼•ä¼˜åŒ–

### 2. åŠŸèƒ½æ‰©å±•æ–¹å‘

- [ ] é¢„çº¦æé†’ï¼ˆçŸ­ä¿¡/é‚®ä»¶/APPæ¨é€ï¼‰
- [ ] é¢„çº¦é‡å¤æ¨¡å¼ï¼ˆå‘¨æœŸæ€§é¢„çº¦ï¼‰
- [ ] é¢„çº¦è¯„ä»·è¯„åˆ†ç»Ÿè®¡
- [ ] é¢„çº¦æ—¶é—´è‡ªåŠ¨æ¨è
- [ ] é¢„çº¦å¼‚å¸¸ç›‘æ§ï¼ˆæœªæŒ‰æ—¶å®Œæˆï¼‰
- [ ] é¢„çº¦å¯¼å‡ºï¼ˆExcelã€PDFï¼‰
- [ ] é¢„çº¦æ—¥å†è§†å›¾
- [ ] å¤šæŠ¤å·¥åˆ†é…ï¼ˆä¸€ä¸ªé¢„çº¦å¤šä¸ªæŠ¤å·¥ï¼‰

---

## æ€»ç»“

é¢„çº¦ç®¡ç†æ¨¡å—æ˜¯æ•´ä¸ªç³»ç»Ÿçš„**æ ¸å¿ƒä¸šåŠ¡é©±åŠ¨**ï¼Œæ˜¯è¿æ¥"æœåŠ¡"å’Œ"è´¹ç”¨"çš„æ¢çº½ã€‚

âœ… **æ ¸å¿ƒä»·å€¼**ï¼š
- å®Œæ•´çš„çŠ¶æ€æµè½¬æ§åˆ¶
- è‡ªåŠ¨åŒ–çš„è´¹ç”¨ç”Ÿæˆ
- çµæ´»çš„æƒé™ç®¡ç†
- æ•°æ®éš”ç¦»å’Œå®‰å…¨æ€§

âœ… **å…³é”®åŠŸèƒ½**ï¼š
- æ–°å»ºé¢„çº¦ â†’ çŠ¶æ€æœºæµè½¬ â†’ å®Œæˆç”Ÿæˆè´¹ç”¨ â†’ æ”¯ä»˜å’Œè¯„ä»·

âš ï¸ **ä¸»è¦æ”¹è¿›æ–¹å‘**ï¼š
- æ—¶é—´å’Œå†²çªéªŒè¯
- ä»·æ ¼å†å²è®°å½•
- å®Œå–„çš„çº§è”åˆ é™¤
- é¢„çº¦æé†’å’Œç›‘æ§

è¯¥æ¨¡å—å±•ç¤ºäº†**å¤æ‚ä¸šåŠ¡æµç¨‹çš„ç³»ç»ŸåŒ–ç®¡ç†**ï¼Œæ˜¯å­¦ä¹ çŠ¶æ€æœºã€ä¸šåŠ¡æµç¨‹è®¾è®¡çš„æœ€ä½³æ¡ˆä¾‹ã€‚

